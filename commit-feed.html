<script>
$(document).ready(function(){
    $(".versionSelector").change(function() {
        var dropDown = $(this);
        var str = dropDown.val();
        var id = $("#" + dropDown.attr("id").replace(/versionSelector-/, "taskAssignments-"));
        if(str[0] != '-') {
            $.getJSON("${project:pkey()}/" + str + "/backlog-list", function(data) {
                id.find("li select option").remove();
                var firstLi = id.find("li:first").clone();
                id.find("li").remove();
                firstLi.appendTo(id);
                $.each(data, function(i, item) {
                    id.find("li select").append("<option value=\"" + item.pkey + "\">" + item.brief + "</option>");
                });
                id.parent().show();
            });
        } else {
            id.parent().hide();
        }
    });
    $(".taskAddition").click(function(event) {
        event.preventDefault();
        var ul = $("#" + $(this).attr("id").replace(/taskAddition-/, "taskAssignments-"));
        ul.find("li:first").clone().appendTo(ul);
    });
    $(".taskAssignments").parent().hide();
    $(".versionSelector").change();
});
</script>
<form action="POST">
<table>
<?lc for h, item in ipairs(rss_items) do ?>
<tr>
    <td>
        <div<a href="${_html(item:link())}">${_html(item:date())}</a></div>
        <div>${item:description()}</div>
    </td>
    <td><select class="versionSelector" id="versionSelector-${h}">
        <option>-- Select A Version--</option><?lc for i, version in ipairs(project:versions()) do ?>
        <option>${_html(version)}</option><?lc end ?>
    </select></td>
    <td>
        <ul class="taskAssignments" id="taskAssignments-${h}">
            <li><select name="taskAssignments-${h}">
            </select></li>
        </ul>
        <a href="#" class="taskAddition" id="taskAddition-${h}">More Tasks</a>
        <input type="hidden" name="taskComment-${h}" value="${_html(item:description())}" />
        <input type="hidden" name="taskDate-${h}" value="${_html(item:date_ts())}" />
    </td>
</tr>
<?lc end ?>
</table>
<input type="submit" value="Update tasks" />
</form>
