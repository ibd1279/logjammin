<?lc if request:has_attribute("_error") then ?><div class="error">${request:attribute("_error")}</div><?lc end ?>
<article>
<h2>Editing task for ${backlog:project():name()} version ${backlog:version()}</h2>
<form method="POST" action="${request:original_request_file()}">
    <input type="hidden" name="project" value="${backlog:project():pkey()}" />
    <input type="hidden" name="version" value="${backlog:version()}" />
    <div>
        <label>Category
            <select name="category">
                <?lc for h, c in ipairs(backlog:project():categories()) do ?><option${backlog:category() == c and " selected" or ""}>${c}</option>
                <?lc end ?>
            </select>
        </label>
    </div>
    <div>
        <label>Priority
            <select name="priority">
                <option value="100-HIGHEST"${tonumber(backlog:priority():sub(0,3)) == 100 and " selected" or ""}>Highest</option>
                <option value="200-HIGHER"${tonumber(backlog:priority():sub(0,3)) == 200 and " selected" or ""}>Higher</option>
                <option value="300-HIGH"${tonumber(backlog:priority():sub(0,3)) == 300 and " selected" or ""}>High</option>
                <option value="400-MEDIUM"${tonumber(backlog:priority():sub(0,3)) == 400 and " selected" or ""}>Medium</option>
                <option value="500-LOW"${tonumber(backlog:priority():sub(0,3)) == 500 and " selected" or ""}>Low</option>
            </select>
        </label>
    </div>
    <div>
        <label>Disposition
            <select name="disposition">
                <option value="100-UNDEFINED"${tonumber(backlog:disposition():sub(0,3)) == 100 and " selected" or ""}>Undefined</option>
                <option value="200-DEFINED"${tonumber(backlog:disposition():sub(0,3)) == 200 and " selected" or ""}>Defined</option>
                <option value="300-ASSIGNED"${tonumber(backlog:disposition():sub(0,3)) == 300 and " selected" or ""}>Assigned</option>
                <option value="400-COMPLETED"${tonumber(backlog:disposition():sub(0,3)) == 400 and " selected" or ""}>Completed</option>
                <option value="500-CLOSED"${tonumber(backlog:disposition():sub(0,3)) == 500 and " selected" or ""}>Closed</option>
            </select>
        </label>
    </div><?lc end ?>
    <div>
        <label>Estimate (hours)
            <input type="text" name="estimate" value="${backlog:estimate()}" />
        </label>
    </div>
    <div>
        <label>Actual (hours)
            <input type="text" name="actual" value="${backlog:actual()}" />
        </label>
    </div>
    <div>
        <label for="backlog-tags">Tags</label>
        <input name="tags" value="" type="text" id="backlog-tags" class="tag-list" />
        <ul class="tag-list">
            <?lc for h, tag in ipairs(backlog:tags()) do if tag:sub(0,9) ~= "assigned:" then ?>
                <li><input name="tags" value="${tag}" type="text" /></li>
            <?lc end end ?>
        </ul>
    </div>
    <div>
        <label for="backlog-assigned">Assigned</label>
        <select name="assigned" id="backlog-assigned" class="tag-list"><option value="">-- New Assignment --</option>
            <?lc for i, user in ipairs(users) do ?><option value="${user:pkey()}">${user:name()}</option>
            <?lc end ?>
        </select>
        <ul class="tag-list">
            <?lc for h, tag in ipairs(backlog:tags()) do if tag:sub(0,9) == "assigned:" and tonumber(tag:sub(10)) then ?>
                <?lc for i, user in ipairs(users) do if tonumber(tag:sub(10)) == user:pkey() then ?>
                    <li><input name="assigned" value="${user:pkey()}" type="text" friendly="${_html(user:name())}" /></li>
                <?lc end end ?>
            <?lc end end ?>
        </ul>
    <div>
        <input value="Save" type="submit" />
    </div>
    <div>
        <label><div>Story</div>
            <textarea name="story" cols="60" rows="8">${backlog:story()}</textarea>
        </label>
    </div>
    <div>
        <input value="Save" type="submit" />
    </div>
    <div>
        <label><div>Comments</div>
            <?lc for h, c in ipairs(backlog:comments()) do ?><div>
                <strong>${_html(os.date("%A, %B %d, %Y %I:%M %p", c:time()))}</strong> by
                <?lc if c:user():aim():len() > 0 then ?><a href="aim:GoIM?screenname=${_html(c:user():aim())}"><img src="http://api.oscar.aol.com/presence/icon?k=ja166APqRZvmttqX&t=${_html(c:user():aim())}" border="0"/><?lc end ?><strong>${_html(c:user():name())}</strong><?lc if c:user():aim():len() > 0 then ?></a><?lc end ?>
                <blockquote>${_html(c:comment())}</blockquote>
            </div><?lc end ?>
            <textarea name="comments" cols="60" rows="8"></textarea>
        </label>
    </div>
    <div>
        <input value="Save" type="submit" />
    </div>
</form>
</article>
