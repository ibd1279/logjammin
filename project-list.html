<?lc if request:has_attribute("_error") then ?><div class="error">
    ${_html(request:attribute("_error"))}
</div><?lc end ?>
<div>
    <form action="project-search">
        <label for="q">Search</label>
        <input type="text" name="q" value="${_html(request:param("q"))}" />
        <input type="submit" value="Search" />
    </form>
</div>
<?lc if request:has_param("q") then ?><div>
    Search results for &quot;${_html(request:param("q"))}&quot;.
</div><?lc elseif _user:check_allowed("backlog:project:write") then ?><div>
    <a href="project-edit">Create a new project...</a>
</div><?lc end ?>
<?lc if projects and table.getn(projects) > 0 then ?>
  <ul id="project-list">
  <?lc for h, project in ipairs(projects) do ?>
    <li>
      ${_html(project:name())} (${table.getn(project:versions())} major version${table.getn(project:versions()) == 1 and "" or "s"}) <a href="${project:pkey()}/project-edit">Edit &darr;</a>
      <?lc if table.getn(project:versions()) > 0 then ?>
      <ul>
        <?lc for i, version in ipairs(project:versions()) do ?><li>${_html(version)} -- Requirements | Releases | Tasks</li><?lc end ?>
      </ul>
      <?lc end ?>
    </li>
  <?lc end ?>
  </ul>
<?lc else ?>
<div>No projects found.</div>
<?lc end ?>
  </tbody>
</table>
<script>
$(document).ready(function() {
    edit_links = $("#project-list li a");
    edit_links.one("click", function() {
        var self = $(this);
        $('<div />').hide()
                .insertAfter(self)
                .load(self.attr('href'), null, function() {
                        self.click(function() { $(this).next().slideToggle(); return false; });
                        self.click();
                });
        return false;
    });
});
</script>