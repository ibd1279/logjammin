<?lc if request:has_attribute("_error") then ?><div class="error">
    ${_html(request:attribute("_error"))}
</div><?lc end ?>
<div>
    <form action="project-search">
        <label for="q">Search</label>
        <input type="text" name="q" value="${_html(request:param("q"))}" />
        <input type="submit" value="Search" />
    </form>
</div>
<?lc if request:has_param("q") then ?><div>
    Search results for &quot;${_html(request:param("q"))}&quot;.
</div><?lc elseif _user:check_allowed("backlog:project:write") then ?><div>
    <a href="project-edit">Create a new project...</a>
</div><?lc end ?>
<?lc if projects and table.getn(projects) > 0 then ?>
  <ul id="project-list">
  <?lc for h, project in ipairs(projects) do ?>
    <li>
      <a name="pe_${project:pkey()}">${_html(project:name())} (${table.getn(project:versions())} major version${table.getn(project:versions()) == 1 and "" or "s"}) <a href="${project:pkey()}/project-edit" class="fetch-toggle">Edit &darr;</a>
      <?lc if table.getn(project:versions()) > 0 then ?>
      <ul>
        <?lc for i, version in ipairs(project:versions()) do ?><li>${_html(version)} -- Requirements | Releases | <a href="${project:pkey()}/${_html(version)}/backlog-list">Tasks</a></li><?lc end ?>
      </ul>
      <?lc end ?>
    </li>
  <?lc end ?>
  </ul>
<?lc else ?>
<div>No projects found.</div>
<?lc end ?>
<script>
$(document).ready(function() {
    if(location.hash) {
        if(location.hash.substring(1,4) == 'pe_') {
            var focus = $("a.fetch-toggle[href^=" + location.hash.substring(4) + "/]");
            focus.click();
        }
    }
});
</script>