<?lc if request:has_attribute("_error") then ?><div class="error">${request:attribute("_error")}</div><?lc end ?>
<form method="POST" action="${request:original_request_file()}">
    <div>
        <label>Project Name
            <input name="name" value="${project:name()}" type="text" />
        </label>
    </div>
    <div>
        <label>RSS Feed
            <input name="commit_feed" value="${project:commit_feed()}" type="text" />
        </label>
    </div>
    <div>
        <label>Daily Hours
            <input name="daily_hours" value="${project:daily_hours()}" type="text" />
        </label>
    </div>
    <div>
        <label>Versions
            <?lc for h, version in ipairs(project:versions()) do ?><input name="version" value="${version}" type="text" />
            <?lc end ?>
            <input name="version" value="" type="text" />
        </label>
    </div>
    <div>
        <label for="project-category">Categories</label>
        <input name="category" value="" type="text" id="project-category" class="tag-list" />
        <ul class="tag-list">
        <?lc for h, category in ipairs(project:categories()) do ?>
            <li><input name="category" value="${category}" type="text"/></li>
        <?lc end ?>
        </ul>
    </div>
    <div>
        <label>Members
            <select name="members" multiple>
            <?lc for h, user in ipairs(users) do ?>
                <option value="${user:pkey()}"${project:has_member(user) and " selected" or ""}>${user:name()}</option>
            <?lc end ?>
            </select>
        </label>
    <div>
    <div>
        <input value="Save" type="submit" />
    </div>
</form>
<?lc if project:pkey() > 0 then ?><div>
    <a href="${project:pkey()}/project-purge">Delete</a>
</div><?lc end ?>
<script>
$(document).ready(function() {
    var taglist_display = function()  {
        $('ul.tag-list li input:text:visible').each(function(i) {
            var self = $(this);
            $('<a href="#">X</a>').insertAfter(self).toggle(function() {
                var parent = $(this).parent();
                parent.children('span').css('text-decoration', 'line-through');
                parent.children('input').attr('disabled', 'disabled');
                return false;
            }, function() {
                var parent = $(this).parent();
                parent.children('span').css('text-decoration', '');
                parent.children('input').removeAttr('disabled');
                return false;
            });
            self.hide();
            $('<span/>').text(self.val()).insertAfter(self);
        });
    };
    $('input.tag-list').keypress(function(e) {
        if(e.which == 13) {
            var self = $(this);
            if(self.val().length < 1) return false;            
            self.siblings('.tag-list').append($('<li/>').append(self.clone(false)));
            taglist_display();
            self.val('');
            return false;
        }
        return true;
    });
    taglist_display();
});
</script>